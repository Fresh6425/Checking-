<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบเช็คชื่อ</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
        table { width: 90%; margin: 20px auto; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        th { background-color: #f4f4f4; }
        input[type="text"] { width: 150px; padding: 5px; }
        .submit-btn { margin-top: 20px; padding: 10px 20px; font-size: 16px; }
        textarea { width: 90%; margin-top: 20px; height: 200px; }
    </style>
</head>
<body>
    <h1>ระบบเช็คชื่อ</h1>

    <div id="student-table"></div>

    <button class="submit-btn" onclick="generateReport()">บันทึกข้อมูล</button>

    <h2>ผลลัพธ์</h2>
    <textarea id="output" readonly></textarea>

    <script>
        const attendanceData = {
            "301": { "ปี 1": ["027", "028"], "ปี 3": ["53", "55"] },
            "302": { "ปี 1": ["029", "050"], "ปี 3": ["61", "78"] },
            "304": { "ปี 1": ["030", "031", "035", "037"] },
            "305": { "ปี 1": ["038", "039"], "ปี 3": ["131", "57"] },
            "309/2": { "ปี 1": ["042"], "ปี 3": ["122"], "ปี 2": ["134", "139"] },
            "310": { "ปี 1": ["043"], "ปี 3": ["66", "69", "132"] },
            "311": { "ปี 1": ["044"], "ปี 4": ["85", "93", "97"] },
            "312": { "ปี 1": ["045"], "ปี 2": ["136", "137", "138"] },
            "315": { "ปี 1": ["046", "047"], "ปี 2": ["108", "109"] },
            "316": { "ปี 1": ["049", "048", "041", "051"] },
            "318": { "ปี 1": ["052", "053"], "ปี 3": ["85", "86"] },
            "307": { "ปี 2": ["015", "104"], "ปี 4": ["17", "43"] },
            "314": { "ปี 2": ["122"], "ปี 3": ["71", "72", "75"] },
            "313": { "ปี 2": ["002", "023", "025", "028"] },
            "319": { "ปี 4": ["02", "06", "26", "103"] },
            "306": { "ปี 3": ["58"], "ปี 4": ["25", "19", "32"] },
            "308": { "ปี 3": ["76", "79", "77"] },
            "317": { "ปี 3": ["80", "82", "83", "84"] },
            "309/1": { "ปี 2": ["106", "107"], "ปี 4": ["125", "80"] }
        };

        function showStudentTable() {
            let studentTable = document.getElementById("student-table");
            let tableHTML = `<table>
                                <tr>
                                    <th>ห้อง</th>
                                    <th>ชั้นปี</th>
                                    <th>รหัสนักเรียน</th>
                                    <th>อยู่</th>
                                    <th>ไม่อยู่</th>
                                    <th>เหตุผล (ถ้าไม่อยู่)</th>
                                </tr>`;

            Object.keys(attendanceData).forEach(room => {
                Object.keys(attendanceData[room]).forEach(year => {
                    attendanceData[room][year].forEach(student => {
                        tableHTML += `<tr>
                                        <td>${room}</td>
                                        <td>${year}</td>
                                        <td>${student}</td>
                                        <td><input type="radio" name="status_${room}_${year}_${student}" value="${student}"></td>
                                        <td><input type="radio" name="status_${room}_${year}_${student}" value="${student}-ไม่อยู่"></td>
                                        <td><input type="text" id="reason_${room}_${year}_${student}" placeholder="เหตุผล (ถ้าไม่อยู่)"></td>
                                      </tr>`;
                    });
                });
            });

            tableHTML += `</table>`;
            studentTable.innerHTML = tableHTML;
        }

        function generateReport() {
            let report = "";

            Object.keys(attendanceData).forEach(year => {
                report += `** ชั้นปีที่ ${year} **\n`;

                Object.keys(attendanceData).forEach(room => {
                    let roomReport = `${room} = `;
                    let studentList = [];

                    Object.keys(attendanceData[room]).forEach(yearInRoom => {
                        if (year === yearInRoom) {
                            attendanceData[room][yearInRoom].forEach(student => {
                                let status = document.querySelector(`input[name="status_${room}_${year}_${student}"]:checked`);
                                let reason = document.getElementById(`reason_${room}_${year}_${student}`).value.trim();
                                
                                if (status) {
                                    if (status.value.endsWith("-ไม่อยู่")) {
                                        studentList.push(`${student} ${reason || "ไม่ระบุ"}`);
                                    } else {
                                        studentList.push(student);
                                    }
                                }
                            });
                        }
                    });

                    if (studentList.length > 0) {
                        report += roomReport + studentList.join(" ") + "\n";
                    }
                });

                report += "\n";
            });

            document.getElementById("output").value = report.trim();
        }

        window.onload = showStudentTable;
    </script>
</body>
</html>